<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>結香共通テストまで</title>
  <style>
    /* ======== 基本設定 ======== */
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
      background: #f9fafc;
      color: #333;
    }
    h1 {
      font-size: 1.8rem;
      margin-top: 20px;
      color: #ff6b6b;
    }
    .container {
      padding: 15px;
      max-width: 420px;
      margin: auto;
    }
    /* ======== カウントダウン ======== */
    #countdown {
      background: #fff;
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      font-size: 1.2rem;
    }
    /* ======== モーダル ======== */
    #popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .popup-content {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      width: 80%;
      max-width: 300px;
      text-align: center;
      animation: fadeIn 0.3s ease;
    }
    .popup-content p {
      font-size: 1rem;
      line-height: 1.6;
      white-space: pre-line;
    }
    .close-btn {
      background: #ff6b6b;
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: 12px;
      margin-top: 12px;
      cursor: pointer;
      font-size: 1rem;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    /* ======== ポモドーロタイマー ======== */
    #timer-section {
      background: #fff;
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #timer-display {
      font-size: 2rem;
      margin: 10px 0;
    }
    input[type="number"] {
      width: 80px;
      padding: 5px;
      margin: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
      font-size: 1rem;
    }
    button {
      background: #4caf50;
      color: white;
      border: none;
      padding: 10px 18px;
      margin: 5px;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }

    /* ======== ToDoリスト ======== */
    #todo-section {
      background: #fff;
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #todo-section ul {
      list-style: none;
      padding: 0;
    }
    #todo-section li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }
    .delete-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    #todo-input {
      width: 70%;
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>結香共通テストまで</h1>
  <div class="container">
    <!-- カウントダウン -->
    <div id="countdown"></div>

    <!-- 応援メッセージ用モーダル -->
    <div id="popup">
      <div class="popup-content">
        <p id="popup-message"></p>
        <button class="close-btn" onclick="closePopup()">閉じる</button>
      </div>
    </div>

    <!-- ポモドーロタイマー -->
    <div id="timer-section">
      <h2>ポモドーロタイマー</h2>
      <div>
        集中 <input type="number" id="focus-time" value="25" min="1"> 分
        休憩 <input type="number" id="break-time" value="5" min="1"> 分
      </div>
      <div id="timer-display">00:00</div>
      <button onclick="startTimer()">スタート</button>
      <button onclick="pauseTimer()">一時停止</button>
      <button onclick="resetTimer()">リセット</button>
    </div>

    <!-- ToDoリスト -->
    <div id="todo-section">
      <h2>ToDoリスト</h2>
      <input type="text" id="todo-input" placeholder="新しいタスク">
      <button onclick="addTodo()">追加</button>
      <ul id="todo-list"></ul>
    </div>
  </div>

  <audio id="bell-sound" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>

  <script>
    const bellSound = document.getElementById("bell-sound");

    document.body.addEventListener('touchstart', () => {
      bellSound.play().then(() => {
        bellSound.pause();
        bellSound.currentTime = 0;
      }).catch(() => {});
    }, { once: true });
    /* ======== カウントダウン ======== */
    const targetDate = new Date("2026-01-17T00:00:00+09:00");

    const messages = {
      "2025-10-09": "今日で本番まであと100日！\nここからが本当の勝負だね。\n焦らず一歩ずつ、確実に積み重ねていこう。\n応援してるよ、がんばれ結香！",
      "2025-11-28": "あと50日！\nここまで頑張ってきた努力は絶対に裏切らないよ。\n体調に気をつけて、最後までやりきろう。\n自分を信じて、がんばれ結香！",
      "2025-12-23": "本番まであと25日。\n今までの積み重ねは結香の力になってるよ。\nもうここまできたら、自分を信じて走り抜け！\nファイト",
      "2026-01-16": "ついに明日だね。\nここまで本当に頑張ってきたこと、全部知ってるよ。\nあとはリラックスして、結香らしく挑んでおいで！\n明日は全力で頑張れ！！"
    };

    function updateCountdown() {
      const now = new Date();
      const diff = targetDate - now;
      if (diff <= 0) {
        document.getElementById("countdown").innerText = "本番当日！頑張れ結香！";
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("countdown").innerText =
        `あと ${days}日 ${hours}時間 ${minutes}分 ${seconds}秒`;

      const today = now.toISOString().split("T")[0];
      if (messages[today]) {
        showPopup(messages[today]);
        delete messages[today]; // 一度表示したら再表示しない
      }
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    function showPopup(message) {
      document.getElementById("popup-message").innerText = message;
      document.getElementById("popup").style.display = "flex";
    }
    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function playAlert() {
      // ベル音を再生
      bellSound.play();

      // 振動 or 代替処理
      if ('vibrate' in navigator) {
        navigator.vibrate(300); // Android対応
      } else {
        // iPhone Safari簡易版: 短い音でTapticEngineを起動
        const haptic = new Audio();
        haptic.src = "data:audio/wav;base64,UklGRkYAAABXQVZFZm10IBAAAAABAAEAESsAABKxAAACABgAZGF0YQwAAAAAAAAAAAD//w==";
        haptic.play();
      }
    }

    /* ======== ポモドーロタイマー ======== */
    let timer;
    let remainingTime = 0;
    let isFocus = true;

    function startTimer() {
      if (!remainingTime) {
        const focusTime = document.getElementById("focus-time").value * 60;
        remainingTime = focusTime;
        isFocus = true;
      }
      timer = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();

        if (remainingTime <= 0) {
          playAlert();
          clearInterval(timer);
          if (isFocus) {
            remainingTime = document.getElementById("break-time").value * 60;
            isFocus = false;
            startTimer();
          } else {
            remainingTime = 0;
            isFocus = true;
          }
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(timer);
    }

    function resetTimer() {
      clearInterval(timer);
      remainingTime = 0;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      document.getElementById("timer-display").innerText =
        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    /* ======== ToDoリスト ======== */
    const todoList = document.getElementById("todo-list");
    const storedTodos = JSON.parse(localStorage.getItem("todos") || "[]");

    function renderTodos() {
      todoList.innerHTML = "";
      storedTodos.forEach((todo, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <span>
            <input type="checkbox" ${todo.done ? "checked" : ""} onchange="toggleDone(${index})">
            ${todo.text}
          </span>
          <button class="delete-btn" onclick="deleteTodo(${index})">削除</button>
        `;
        todoList.appendChild(li);
      });
      localStorage.setItem("todos", JSON.stringify(storedTodos));
    }

    function addTodo() {
      const input = document.getElementById("todo-input");
      if (input.value.trim()) {
        storedTodos.push({ text: input.value.trim(), done: false });
        input.value = "";
        renderTodos();
      }
    }

    function toggleDone(index) {
      storedTodos[index].done = !storedTodos[index].done;
      renderTodos();
    }

    function deleteTodo(index) {
      storedTodos.splice(index, 1);
      renderTodos();
    }

    renderTodos();
  </script>
</body>
</html>